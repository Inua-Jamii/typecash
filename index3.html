<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Complete Your Purchase</title>
<!-- Google Fonts for a modern look -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans&display=swap" rel="stylesheet"/>
<style>
  body {
    font-family: 'Open Sans', sans-serif;
    background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
    padding: 50px 20px;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(15px);
    padding: 40px;
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  h1 {
    font-family: 'Montserrat', sans-serif;
    font-size: 2.8em;
    margin-bottom: 10px;
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  p {
    font-size: 1.2em;
    color: #fff;
    margin-bottom: 20px;
  }

  /* Instructions */
  .instructions {
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    width: 100%;
  }
  .instructions p {
    margin: 10px 0;
    font-size: 1.1em;
  }

  /* Form styles */
  form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
  }

  input[type="text"], input[type="number"] {
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-size: 1em;
  }

  input[type="text"]:focus, input[type="number"]:focus {
    outline: none;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
  }

  /* Error message styles */
  .error-message {
    color: red;
    font-size: 0.9em;
    margin-top: 2px;
    display: none;
    min-height: 1em;
  }

  /* Buy Button at bottom */
  .buy-btn {
    background: linear-gradient(135deg, #ff7e5f, #feb47b);
    color: #fff;
    padding: 15px 30px;
    border: none;
    border-radius: 25px;
    font-size: 1.4em;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    margin-top: 40px;
  }
  .buy-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }

  /* Pay Now Button */
  .pay-btn {
    background: linear-gradient(135deg, #00c3ff, #ffff1c);
    color: #fff;
    padding: 15px;
    border: none;
    border-radius: 25px;
    font-size: 1.4em;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
  }
  .pay-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }

  /* Responsive styles */
  @media(max-width: 600px) {
    body {
      padding: 20px;
    }
    h1 {
      font-size: 2em;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>Complete Your Payment</h1>
  <p>You'll receive an STK PUSH to activate your account. After your payment, you'll receive your login details via SMS.</p>

  <div class="instructions" style="margin-top:20px;">
    <p>Proceed to pay the amount below and activate your account seamlessly.</p>
  </div>

  <button class="buy-btn" onclick="buyAccount()">Buy Account Now</button>

  <form id="paymentForm" style="display:none; margin-top:30px;" onsubmit="return handlePayment(event)">
    <label for="phone">M-Pesa Phone Number:</label>
    <input type="text" id="phone" placeholder="e.g., 0700123456" required />
    <div class="error-message" id="phoneError"></div>

    <label for="name">Your Name:</label>
    <input type="text" id="name" placeholder="Full Name" required />

    <input type="hidden" id="amount" />

    <div style="margin-top:20px; font-size:1.2em; font-weight:bold; color:#fff;">
      Amount to Pay: Ksh <span id="displayAmount"></span>
    </div>

    <button class="pay-btn" type="submit" style="margin-top:30px;">Pay Now</button>
  </form>
</div>

<script>
  // Function to retrieve URL parameter
  function getParameterByName(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // On page load, get the fee and display
  const fee = getParameterByName('fee');
  document.getElementById('amount').value = fee;
  document.getElementById('displayAmount').textContent = fee;

  // Show the payment form when "Buy Account Now" is clicked
  function buyAccount() {
    document.getElementById('paymentForm').style.display = 'block';
    document.querySelector('.instructions').scrollIntoView({behavior: 'smooth'});
  }

  function showError(message) {
    const errorDiv = document.getElementById('phoneError');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';

    setTimeout(() => {
      errorDiv.style.display = 'none';
    }, 2000);
  }

  function handlePayment(e) {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    let phone = document.getElementById('phone').value.trim();
    const amount = document.getElementById('amount').value;

    // Validate presence
    if (!phone || !name) {
      showError('Please fill in all fields.');
      return false;
    }

    // Remove spaces and dashes
    phone = phone.replace(/\s+/g, '').replace(/-/g, '');

    let finalNumber = '';

    // Check if number starts with +254 or 254
    if (phone.startsWith('+254')) {
      const numberPart = phone.substring(4); // after +254
      if (!/^\d+$/.test(numberPart)) {
        showError('Invalid characters in phone number.');
        return false;
      }
      // Accept only if numberPart length is 9 (since total should be 10 digits)
      if (numberPart.length !== 9) {
        showError('Invalid length for phone number.');
        return false;
      }
      // Construct 07 or 01 prefix
      const firstDigit = numberPart.charAt(0);
      if (firstDigit === '7') {
        finalNumber = '07' + numberPart.substring(1);
      } else if (firstDigit === '1') {
        finalNumber = '01' + numberPart.substring(1);
      } else {
        showError('Number should start with 7 or 1 after country code.');
        return false;
      }
    } else if (phone.startsWith('254')) {
      const numberPart = phone.substring(3);
      if (!/^\d+$/.test(numberPart)) {
        showError('Invalid characters in phone number.');
        return false;
      }
      if (numberPart.length !== 9) {
        showError('Invalid length for phone number.');
        return false;
      }
      const firstDigit = numberPart.charAt(0);
      if (firstDigit === '7') {
        finalNumber = '07' + numberPart.substring(1);
      } else if (firstDigit === '1') {
        finalNumber = '01' + numberPart.substring(1);
      } else {
        showError('Number should start with 7 or 1 after country code.');
        return false;
      }
    } else {
      // Accept plain 10-digit number starting with 07 or 01
      if (!/^\d{10}$/.test(phone)) {
        showError('Enter a valid 10-digit number starting with 07 or 01.');
        return false;
      }
      if (phone.startsWith('07') || phone.startsWith('01')) {
        finalNumber = phone;
      } else {
        showError('Number must start with 07 or 01.');
        return false;
      }
    }

    // Final check for length
    if (finalNumber.length !== 10) {
      showError('Number must be exactly 10 digits.');
      return false;
    }

    // Proceed with payment
    alert(`Processing Ksh ${amount} payment via M-Pesa for ${name} (${finalNumber})...`);
    alert('Payment successful! Your account will be activated shortly.');
  }
</script>

</body>
</html>
